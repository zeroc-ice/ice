<?xml version="1.0" encoding="utf-8"?>
<!-- Copyright (c) ZeroC, Inc. -->
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
    <PropertyGroup>
        <!-- Internal properties used to compute the slice2cs compiler location for the current platform. -->
        <_IceOSName Condition="$([MSBuild]::IsOSPlatform('Linux'))">linux</_IceOSName>
        <_IceOSName Condition="$([MSBuild]::IsOSPlatform('Windows'))">windows</_IceOSName>
        <_IceOSName Condition="$([MSBuild]::IsOSPlatform('OSX'))">macos</_IceOSName>
        <_IceOSArch
        >$([System.Runtime.InteropServices.RuntimeInformation]::OSArchitecture.ToString().ToLower())</_IceOSArch>
    </PropertyGroup>

    <!-- default values -->
    <Choose>
        <!-- NuGet creates .nuspec files with all lowercase names -->
        <When Condition="Exists('$(MSBuildThisFileDirectory)..\zeroc.ice.slice.tools.nuspec')">
            <!-- Use the Slice compiler from this NuGet package -->
            <PropertyGroup>
                <_IceSliceToolsPath>$(MSBuildThisFileDirectory)..\tools\$(_IceOSName)-$(_IceOSArch)\</_IceSliceToolsPath>

                <!-- AssemblyTaskFactory is the default value when no TaskFactory is specified -->
                <_IceSliceToolsTaskFactory>AssemblyTaskFactory</_IceSliceToolsTaskFactory>
            </PropertyGroup>
        </When>
        <Otherwise>
            <PropertyGroup>
                <!-- Use the Slice compiler from this Source distribution -->
                <_IceSliceToolsSourceBuild>true</_IceSliceToolsSourceBuild>
                <_IceSliceToolsPath>$(MSBuildThisFileDirectory)..\..\..\cpp\bin\</_IceSliceToolsPath>
                <_IceSliceToolsPath Condition="'$(_IceOSName)' == 'windows'">$(_IceSliceToolsPath)x64\$(Configuration)\</_IceSliceToolsPath>

                <!-- Force task to run out of process to avoid issues with files in use -->
                <_IceSliceToolsTaskFactory>TaskHostFactory</_IceSliceToolsTaskFactory>
            </PropertyGroup>
        </Otherwise>
    </Choose>

    <!-- Default SliceCompile settings -->
    <ItemDefinitionGroup>
        <SliceCompile>
            <OutputDir>$(MSBuildProjectDirectory)\generated</OutputDir>
        </SliceCompile>
    </ItemDefinitionGroup>
</Project>
