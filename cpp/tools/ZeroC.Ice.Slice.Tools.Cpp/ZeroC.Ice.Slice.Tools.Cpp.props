<?xml version="1.0" encoding="utf-8"?>
<!-- Copyright (c) ZeroC, Inc. -->
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
    <!-- default values -->
    <Choose>
        <When Condition="Exists('$(MSBuildThisFileDirectory)..\tools\slice2cpp.exe')">
            <!-- Use the Slice compiler from this NuGet package -->
            <PropertyGroup>
                <_IceSliceToolsPath>$(MSBuildThisFileDirectory)..\tools\</_IceSliceToolsPath>

                <!-- AssemblyTaskFactory is the default value when no TaskFactory is specified -->
                <_IceSliceToolsTaskFactory>AssemblyTaskFactory</_IceSliceToolsTaskFactory>
            </PropertyGroup>
        </When>
        <Otherwise>
            <PropertyGroup>
                <!-- Use the Slice compiler from this Source distribution -->
                <_IceSliceToolsPath>$(MSBuildThisFileDirectory)..\..\..\cpp\bin\x64\$(Configuration)</_IceSliceToolsPath>

                <!-- Force task to run out of process to avoid issues with files in use -->
                <_IceSliceToolsTaskFactory>TaskHostFactory</_IceSliceToolsTaskFactory>
            </PropertyGroup>
        </Otherwise>
    </Choose>

    <ItemDefinitionGroup>
        <SliceCompile>
            <OutputDir>$(IntDir)</OutputDir>
            <HeaderExt>h</HeaderExt>
            <SourceExt>cpp</SourceExt>
        </SliceCompile>
    </ItemDefinitionGroup>

    <Choose>
        <When Condition="Exists('$(MSBuildThisFileDirectory)..\tools\slice2cpp.exe')">
            <!-- Default SliceCompile settings for NuGet package -->
            <ItemDefinitionGroup>
                <SliceCompile>
                    <IncludeDirectories>$(MSBuildThisFileDirectory)..\slice</IncludeDirectories>
                </SliceCompile>
            </ItemDefinitionGroup>
        </When>
        <Otherwise>
            <!-- Default SliceCompile settings for Ice source builds -->
            <ItemDefinitionGroup>
                <SliceCompile>
                    <IncludeDirectories>$(MSBuildThisFileDirectory)..\..\..\slice</IncludeDirectories>
                </SliceCompile>
            </ItemDefinitionGroup>
        </Otherwise>
    </Choose>
</Project>
