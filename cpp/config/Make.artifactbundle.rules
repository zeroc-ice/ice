# Copyright (c) ZeroC, Inc.

# Creates the slice2swift artifact bundle for SwiftPM
#
# This rule creates a SwiftPM executable artifact bundle containing the slice2swift binary.
# The bundle is used by Package.swift to provide the slice2swift tool to the CompileSlice plugin.

slice2swift_artifactbundle := bin/slice2swift.artifactbundle

# Get the slice2swift binary path - it's built by the translator project
slice2swift_binary = $(slice2swift[$(build-platform)-static]_targetdir)/slice2swift

define create-slice2swift-artifactbundle

$(slice2swift_artifactbundle): $(slice2swift_binary)
	$(E) Creating $(slice2swift_artifactbundle)
	$(Q)$(RM) -r $(slice2swift_artifactbundle)
	$(Q)$(MKDIR) -p $(slice2swift_artifactbundle)/slice2swift-macos-arm64/bin
	$(Q)cp $(slice2swift_binary) $(slice2swift_artifactbundle)/slice2swift-macos-arm64/bin/slice2swift
	$(Q)cp $(lang_srcdir)/config/slice2swift.artifactbundle.info.json $(slice2swift_artifactbundle)/info.json

srcs all:: $(slice2swift_artifactbundle)

clean::
	$(E) Cleaning $(slice2swift_artifactbundle)
	$(Q)$(RM) -r $(slice2swift_artifactbundle)

endef

define make-slice2swift-artifactbundle
$(eval $(call create-slice2swift-artifactbundle))
endef
