// **********************************************************************
//
// Copyright (c) 2003-2014 ZeroC, Inc. All rights reserved.
//
// This copy of Ice is licensed to you under the terms described in the
// ICE_LICENSE file included in this distribution.
//
// **********************************************************************

ext.useLocalOnly = localOnly == "true"

// Determine the name of the Slice-to-Java translator
def isWindows = false
def slice2java = "slice2java"
def slice2freezej = "slice2freezej"
if (System.properties['os.name'].toLowerCase().contains('windows'))
{
    isWindows = true
    slice2java = "slice2java.exe"
    slice2freezej = "slice2freezej.exe"
}

// First check if iceHome was set in
if (iceHome)
{
	def translator = new File("$iceHome/bin/$slice2java")
	if (!translator.exists())
	{
		throw new GradleException("Unable to find $slice2java in $iceHome, please verify iceHome is " +
								  "properly configured in gradle.properties and Ice is correctly installed.")
	}
}

// Next check if ICE_HOME is set and it points at a valid installation
def env = System.getenv()
iceHome = env['ICE_HOME']
if (iceHome)
{
	def translator = new File("$iceHome/bin/$slice2java")
	if (!translator.exists())
	{
		throw new GradleException("Unable to find $slice2java in $iceHome, please verify ICE_HOME is " +
								  "properly configured and Ice is correctly installed.")
	}
}

def iceBinDist = true

// First check if we are building against source distribution
def iceDir
if (iceHome)
{
	iceDir = iceHome
}

if (iceDir == null)
{
	def f1 = new File("/usr/bin/$slice2java")
	if (f1.exists())
	{
		iceDir = "/usr"
	}
}

if (iceDir == null && isWindows)
{
	def progFiles
	def arch1 = env['PROCESSOR_ARCHITECTURE']
	def arch2 = env['PROCESSOR_ARCHITEW6432']
	if (arch1 == "AMD64" || arch1 == "IA64" || arch2 == "AMD64" || arch2 == "IA64")
	{
		progFiles = env['ProgramFiles(x86)']
	}
	else
	{
		progFiles = env['ProgramFiles']
	}
	iceDir = "$progFiles\\ZeroC\\Ice-${project.version}"
}

if (iceDir == null)
{
	def f1 = new File("/Library/Developer/Ice-${project.version}/bin/$slice2java")
	if (f1.exists())
	{
		iceDir = "/Library/Developer/Ice-${project.version}"
	}
}

if (iceDir == null)
{
	def f1 = new File("/opt/Ice-${project.version}/bin/$slice2java")
	if (f1.exists())
	{
		iceDir = "/opt/Ice-${project.version}"
	}
}

if (iceDir == null)
{
	throw new GradleException("Unable to find a valid Ice distribution, please verify ICE_HOME is properly " +
							  "configured and Ice is correctly installed.")
}

// Set the slice and java jar directory
if (iceDir == "/usr")
{
	ext.distJarDir = "/usr/share/java"
}
else
{
	ext.distJarDir = "$iceDir/lib"
}

