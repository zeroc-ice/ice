Introduction
------------

This demo shows how to integrate Google Protocol Buffers with Ice.

The Protocol Buffers distribution and documentation can be found at

  http://code.google.com/apis/protocolbuffers/

This demo was tested with Protocol Buffers version 2.5.0.

The Slice-to-C++ compiler, slice2cpp, supports metadata that allows
you to specify an alternate mapping for a sequence<byte> type. The
generated code uses the type name you supply in place of the sequence
name. There are two prerequisites: you must add a metadata directive
to include the header file containing the definition of your alternate
type, and you must supply code that Ice can use to marshal and
unmarshal instances of your alternate type.

For example, here is a metadata directive that specifies an alternate
type name for a byte sequence:

  ["cpp:type:tutorial::Person"] sequence<byte> Person;

The type name specified in this example, tutorial::Person, corresponds
to the C++ class generated by the Protocol Buffers compiler (protoc)
for the definition shown below:

  package tutorial;
  message Person { ... };

We must also add the following metadata directive before any other
Slice definitions to ensure the definition of tutorial::Person is
visible:

  [["cpp:include:Person.pb.h"]]

Finally, we need to define the marshaling code. The header file
StreamProtobuf.h in this directory contains template definitions that
can be used with any Protocol Buffer message types. We also need to
include this code using a cpp:include metadata directive.

Refer to Hello.ice in this directory for the complete example.


Building the demo on Linux/OS X/Unix
------------------------------------

If you are using a non-RPM install or have not installed Ice in the
default location (/opt/Ice-VERSION) then you will need to set the
environment variable ICE_HOME to point to the root directory of your
Ice installation:

  $ export ICE_HOME=<Ice installation root directory>

Please review the Makefile in this directory and adjust the value
of PROTOBUF_HOME to reflect the installation directory of Protocol
Buffers on your system.

Use this command to build the demo:

  $ make (or gmake depending on system)


Building the demo on Windows
----------------------------

For Windows, Visual Studio project files are provided for building the
demo. These projects require the Ice Visual Studio Add-In, which is
installed automatically by the Ice installer.

Open the Ice.protobuf.sln solution. For each project, open the project
properties and modify the VC++ Directories. You will need to add the
Protocol Buffers bin directory to "Executable Directories", the
include directory to "Include Directories", and the lib directory to
"Library Directories".

Next, select the target configuration (Debug or Release), right-click
on the solution in the Solution Explorer window and select
"Build Solution".

Note that on Windows the Protocol Buffers source package does not
support automatic installation. The build system for this demo
assumes that you have compiled and manually installed Protocol Buffers
using the following directory structure:

%PROTOBUF_HOME%\bin

    Contains protoc.exe

%PROTOBUF_HOME%\lib

    Contains libprotobuf.lib and libprotobufd.lib, the release and
    debug static libraries, respectively. (The debug library was
    renamed to libprotobufd.lib.)

%PROTOBUF_HOME%\include

    Contains the output of the extract_includes.bat batch file that
    copies the include files contained in the Protocol Buffers
    distribution.


Running the demo
----------------

First you must ensure that your environment is set up to run Ice
applications. Please see the documentation that came with your Ice
distribution for more information.

To run the demo, first start the server:

  $ server

In a separate window, start the client:

  $ client
