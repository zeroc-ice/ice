<!--
 **********************************************************************

 Copyright (c) 2003-2015 ZeroC, Inc. All rights reserved.

 This copy of Ice Protobuf is licensed to you under the terms described
 in the ICE_PROTOBUF_LICENSE file included in this distribution.

 **********************************************************************
-->

<project name="test_java" default="all" basedir=".">

    <!-- set global properties for this build -->
    <property name="top.dir" value="../.."/>

    <!-- import common definitions -->
    <import file="${top.dir}/config/common.xml"/>

    <target name="protoc" depends="init">
        <!-- Build protoc task -->
        <mkdir dir="${class.dir}"/>
        <javac srcdir="ant" destdir="${class.dir}" debug="${debug}">
	    <!--compilerarg value="${javac.lint}"/-->
	    <compilerarg value="-Xlint:unchecked"/>
        </javac>
    </target>

    <target name="generate" depends="protoc">
        <!-- Add the protoc task -->
        <taskdef name="protoc" classpath="${class.dir}" classname="ProtocTask" />
        <!-- Create the output directory for generated code -->
        <mkdir dir="${generated.dir}"/>
        <slice2java outputdir="${generated.dir}">
	    <meta value="${java2metadata}"/>
            <fileset dir="." includes="Test.ice"/>
            <includepath>
                <pathelement path="${slice.dir}" />
            </includepath>
        </slice2java>
        <protoc outputdir="${generated.dir}" protocpath=".">
            <fileset dir="." includes="Test.proto"/>
        </protoc>
    </target>

    <target name="compile" depends="generate">
        <mkdir dir="${class.dir}"/>
        <javac srcdir="." destdir="${class.dir}" includes="Serialize/**"
	    classpathref="ice.classpath" debug="${debug}">
	    <compilerarg value="${javac.lint}"/>
	</javac>
        <javac srcdir="${generated.dir}" destdir="${class.dir}"
	    classpathref="ice.classpath" debug="${debug}">
	    <compilerarg value="${javac.lint}"/>
	</javac>
	<javac srcdir="." destdir="${class.dir}"
	    classpathref="ice.classpath" excludes="generated/**,Serialize/**" debug="${debug}">
	    <compilerarg value="${javac.lint}"/>
	</javac>
    </target>

    <target name="all" depends="compile"/>

    <target name="clean">
        <delete dir="${generated.dir}"/>
        <delete dir="${class.dir}"/>
    </target>

</project>
